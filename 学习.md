# 懒加载-自定义全局指令

一开始只加载前面部分，随着下滑，进入视口区域才加载后面的内容。  

## 定义全局自定义指令

自定义一个到达视口区域后自动加载的指令`img-lazy`,然后在`<img/>`中使用`v-img-lazy`属性实现图片的懒加载
[官方文档]("https://cn.vuejs.org/guide/reusability/custom-directives.html")

```vue3
main.js

// 定义全局自定义指令
app.directive("img-lazy",{
    mounted(el,binding){
        // el: 指令绑定的那个元素 img
        // binding: binging.value 绑定到表达式的值=>这里是图片url
        console.log(el,binding.value);
    }
})
```

## 判断是否进入视口区域

使用`vueUse`中提供功能。`useIntersectionObserver`函数能够判断。

```vue3
// 定义全局自定义指令
app.directive("img-lazy", {
    mounted(el, binding) {
        // el: 指令绑定的那个元素 img
        // binding: binging.value 绑定到表达式的值=>这里是图片url
        // console.log(el,binding.value);

        useIntersectionObserver(
            el,
            ([{ isIntersecting }]) => {
               // isIntersecting :bool, 是否进入视口区域
               if(isIntersecting){
                // 将Url赋值给src后就会自动的去请求该url, 注意需要将原来的src删除
                el.src = binding.value
               }
            },
        )
    }
})
```
